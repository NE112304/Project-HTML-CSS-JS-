<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tables - Gestion de Restaurant</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <h2>RestoManager</h2>
            <nav>
                <ul>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="plats.html">Plats (Menu)</a></li>
                    <li><a href="commandes.html">Commandes</a></li>
                    <li><a href="tables.html" class="active">Tables</a></li>
                    <li><a href="reservations.html">Réservations</a></li>
                    <li><a href="employes.html">Employés</a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                &copy; 2026 Restaurant
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="header">
                <h1>Gestion des Tables</h1>
                <button class="btn btn-primary" onclick="openModal()">
                    <span>+</span> Nouvelle Table
                </button>
            </header>

            <!-- Table -->
            <div class="table-container">
                <table id="tablesTable">
                    <thead>
                        <tr>
                            <th>Numéro</th>
                            <th>Capacité</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Modal Form -->
    <div id="tableModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Ajouter une Table</h3>
                <button class="close-modal" onclick="closeModal()">&times;</button>
            </div>
            <form id="tableForm">
                <input type="hidden" id="tableId">
                <div class="form-group">
                    <label for="numero">Numéro de Table</label>
                    <input type="text" id="numero" placeholder="ex: T12" required>
                </div>
                <div class="form-group">
                    <label for="capacite">Capacité (personnes)</label>
                    <input type="number" id="capacite" min="1" required>
                </div>
                <div class="form-group">
                    <label for="status">Statut</label>
                    <select id="status" required>
                        <option value="Disponible">Disponible</option>
                        <option value="Occupée">Occupée</option>
                        <option value="Réservée">Réservée</option>
                        <option value="Nettoyage">Nettoyage</option>
                    </select>
                </div>
                <div class="text-right mt-4">
                    <button type="button" class="btn btn-danger" onclick="closeModal()">Annuler</button>
                    <button type="submit" class="btn btn-success">Sauvegarder</button>
                </div>
            </form>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // DOM Elements
        const modal = document.getElementById('tableModal');
        const form = document.getElementById('tableForm');
        const tableBody = document.querySelector('#tablesTable tbody');
        const modalTitle = document.getElementById('modalTitle');

        // Render functions
        function renderTable() {
            const tables = DataManager.getAll(STORAGE_KEYS.TABLES);
            tables.sort((a, b) => a.numero.localeCompare(b.numero, undefined, { numeric: true })); // Sort naturally

            tableBody.innerHTML = tables.map(table => {
                let badgeClass = 'badge-neutral';
                if (table.status === 'Disponible') badgeClass = 'badge-success';
                else if (table.status === 'Occupée') badgeClass = 'badge-danger';
                else if (table.status === 'Réservée') badgeClass = 'badge-warning';

                return `
                <tr>
                    <td><strong>${table.numero}</strong></td>
                    <td>${table.capacite} pers.</td>
                    <td><span class="badge ${badgeClass}">${table.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="editTable(${table.id})">Modifier</button>
                        <button class="btn btn-sm btn-info" onclick="viewDetails(${table.id})">Informations</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteTable(${table.id})">Supprimer</button>
                    </td>
                </tr>
            `}).join('');
        }

        // Modal functions
        function openModal(isEdit = false) {
            modal.classList.add('active');
            modalTitle.textContent = isEdit ? 'Modifier la Table' : 'Ajouter une Table';
            if (!isEdit) {
                form.reset();
                document.getElementById('tableId').value = '';
            }
        }

        function closeModal() {
            modal.classList.remove('active');
        }

        function viewDetails(id) {
            const tables = DataManager.getAll(STORAGE_KEYS.TABLES);
            const table = tables.find(t => t.id === id);
            if (table) {
                openDetailsModal('Détails de la Table', table);
            }
        }

        // CRUD Operations
        function editTable(id) {
            const tables = DataManager.getAll(STORAGE_KEYS.TABLES);
            const table = tables.find(t => t.id === id);
            if (table) {
                document.getElementById('tableId').value = table.id;
                document.getElementById('numero').value = table.numero;
                document.getElementById('capacite').value = table.capacite;
                document.getElementById('status').value = table.status;
                openModal(true);
            }
        }

        function deleteTable(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer cette table ?')) {
                DataManager.delete(STORAGE_KEYS.TABLES, id);
                renderTable();
            }
        }

        // Form Submit
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const id = document.getElementById('tableId').value;
            const tableData = {
                id: id ? parseInt(id) : null,
                numero: document.getElementById('numero').value,
                capacite: parseInt(document.getElementById('capacite').value),
                status: document.getElementById('status').value
            };

            if (id) {
                DataManager.update(STORAGE_KEYS.TABLES, tableData);
            } else {
                DataManager.add(STORAGE_KEYS.TABLES, tableData);
            }

            closeModal();
            renderTable();
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', renderTable);
        window.onclick = (event) => {
            if (event.target == modal) closeModal();
        };
    </script>
</body>

</html>