<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu - Gestion de Restaurant</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <h2>RestoManager</h2>
            <nav>
                <ul>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="plats.html" class="active">Plats (Menu)</a></li>
                    <li><a href="commandes.html">Commandes</a></li>
                    <li><a href="tables.html">Tables</a></li>
                    <li><a href="reservations.html">Réservations</a></li>
                    <li><a href="employes.html">Employés</a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                &copy; 2026 Restaurant
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="header">
                <h1>Gestion des Plats</h1>
                <button class="btn btn-primary" onclick="openModal()">
                    <span>+</span> Nouveau Plat
                </button>
            </header>

            <!-- Table -->
            <div class="table-container">
                <table id="platsTable">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Description</th>
                            <th>Catégorie</th>
                            <th>Prix</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Modal Form -->
    <div id="platModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Ajouter un Plat</h3>
                <button class="close-modal" onclick="closeModal()">&times;</button>
            </div>
            <form id="platForm">
                <input type="hidden" id="platId">
                <div class="form-group">
                    <label for="nom">Nom du Plat</label>
                    <input type="text" id="nom" required>
                </div>
                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label for="category">Catégorie</label>
                    <select id="category" required>
                        <option value="Entrée">Entrée</option>
                        <option value="Plat Principal">Plat Principal</option>
                        <option value="Dessert">Dessert</option>
                        <option value="Boisson">Boisson</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="prix">Prix (DH)</label>
                    <input type="number" id="prix" step="0.50" min="0" required>
                </div>
                <div class="text-right mt-4">
                    <button type="button" class="btn btn-danger" onclick="closeModal()">Annuler</button>
                    <button type="submit" class="btn btn-success">Sauvegarder</button>
                </div>
            </form>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // DOM Elements
        const modal = document.getElementById('platModal');
        const form = document.getElementById('platForm');
        const tableBody = document.querySelector('#platsTable tbody');
        const modalTitle = document.getElementById('modalTitle');

        // Render functions
        function renderTable() {
            const plats = DataManager.getAll(STORAGE_KEYS.PLATS);
            tableBody.innerHTML = plats.map(plat => `
                <tr>
                    <td><strong>${plat.nom}</strong></td>
                    <td>${plat.description}</td>
                    <td><span class="badge badge-neutral">${plat.category}</span></td>
                    <td style="font-weight: 600;">${formatCurrency(plat.prix)}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="editPlat(${plat.id})">Modifier</button>
                        <button class="btn btn-sm btn-info" onclick="viewDetails(${plat.id})">Informations</button>
                        <button class="btn btn-sm btn-danger" onclick="deletePlat(${plat.id})">Supprimer</button>
                    </td>
                </tr>
            `).join('');
        }

        // Modal functions
        function openModal(isEdit = false) {
            modal.classList.add('active');
            modalTitle.textContent = isEdit ? 'Modifier le Plat' : 'Ajouter un Plat';
            if (!isEdit) {
                form.reset();
                document.getElementById('platId').value = '';
            }
        }

        function closeModal() {
            modal.classList.remove('active');
        }

        function viewDetails(id) {
            const plats = DataManager.getAll(STORAGE_KEYS.PLATS);
            const plat = plats.find(p => p.id === id);
            if (plat) {
                openDetailsModal('Détails du Plat', plat);
            }
        }

        // CRUD Operations
        function editPlat(id) {
            const plats = DataManager.getAll(STORAGE_KEYS.PLATS);
            const plat = plats.find(p => p.id === id);
            if (plat) {
                document.getElementById('platId').value = plat.id;
                document.getElementById('nom').value = plat.nom;
                document.getElementById('description').value = plat.description;
                document.getElementById('category').value = plat.category;
                document.getElementById('prix').value = plat.prix;
                openModal(true);
            }
        }

        function deletePlat(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer ce plat ?')) {
                DataManager.delete(STORAGE_KEYS.PLATS, id);
                renderTable();
            }
        }

        // Form Submit
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const id = document.getElementById('platId').value;
            const platData = {
                id: id ? parseInt(id) : null,
                nom: document.getElementById('nom').value,
                description: document.getElementById('description').value,
                category: document.getElementById('category').value,
                prix: parseFloat(document.getElementById('prix').value)
            };

            if (id) {
                DataManager.update(STORAGE_KEYS.PLATS, platData);
            } else {
                DataManager.add(STORAGE_KEYS.PLATS, platData);
            }

            closeModal();
            renderTable();
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', renderTable);
        // Close modal when clicking outside
        window.onclick = (event) => {
            if (event.target == modal) closeModal();
        };
    </script>
</body>

</html>