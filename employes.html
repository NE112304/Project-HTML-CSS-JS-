<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employés - Gestion de Restaurant</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <h2>RestoManager</h2>
            <nav>
                <ul>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="plats.html">Plats (Menu)</a></li>
                    <li><a href="commandes.html">Commandes</a></li>
                    <li><a href="tables.html">Tables</a></li>
                    <li><a href="reservations.html">Réservations</a></li>
                    <li><a href="employes.html" class="active">Employés</a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                &copy; 2026 Restaurant
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="header">
                <h1>Gestion des Employés</h1>
                <button class="btn btn-primary" onclick="openModal()">
                    <span>+</span> Nouvel Employé
                </button>
            </header>

            <!-- Table -->
            <div class="table-container">
                <table id="employesTable">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Poste</th>
                            <th>Shift (Horaires)</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Modal Form -->
    <div id="employeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Ajouter un Employé</h3>
                <button class="close-modal" onclick="closeModal()">&times;</button>
            </div>
            <form id="employeForm">
                <input type="hidden" id="employeId">
                <div class="form-group">
                    <label for="nom">Nom Complet</label>
                    <input type="text" id="nom" required>
                </div>
                <div class="form-group">
                    <label for="poste">Poste</label>
                    <select id="poste" required>
                        <option value="Serveur">Serveur</option>
                        <option value="Chef">Chef</option>
                        <option value="Cuisinier">Cuisinier</option>
                        <option value="Manager">Manager</option>
                        <option value="Plongeur">Plongeur</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="shift">Shift / Horaires</label>
                    <input type="text" id="shift" placeholder="ex: Matin (08h-16h)" required>
                </div>
                <div class="text-right mt-4">
                    <button type="button" class="btn btn-danger" onclick="closeModal()">Annuler</button>
                    <button type="submit" class="btn btn-success">Sauvegarder</button>
                </div>
            </form>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // DOM Elements
        const modal = document.getElementById('employeModal');
        const form = document.getElementById('employeForm');
        const tableBody = document.querySelector('#employesTable tbody');
        const modalTitle = document.getElementById('modalTitle');

        // Render functions
        function renderTable() {
            const employes = DataManager.getAll(STORAGE_KEYS.EMPLOYES);

            tableBody.innerHTML = employes.map(emp => `
                <tr>
                    <td><strong>${emp.nom}</strong></td>
                    <td><span class="badge badge-neutral">${emp.poste}</span></td>
                    <td>${emp.shift}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="editEmploye(${emp.id})">Modifier</button>
                        <button class="btn btn-sm btn-info" onclick="viewDetails(${emp.id})">Informations</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteEmploye(${emp.id})">Supprimer</button>
                    </td>
                </tr>
            `).join('');
        }

        // Modal functions
        function openModal(isEdit = false) {
            modal.classList.add('active');
            modalTitle.textContent = isEdit ? 'Modifier l\'Employé' : 'Ajouter un Employé';
            if (!isEdit) {
                form.reset();
                document.getElementById('employeId').value = '';
            }
        }

        function closeModal() {
            modal.classList.remove('active');
        }

        function viewDetails(id) {
            const employes = DataManager.getAll(STORAGE_KEYS.EMPLOYES);
            const emp = employes.find(e => e.id === id);
            if (emp) {
                openDetailsModal('Détails de l\'Employé', emp);
            }
        }

        // CRUD Operations
        function editEmploye(id) {
            const employes = DataManager.getAll(STORAGE_KEYS.EMPLOYES);
            const emp = employes.find(e => e.id === id);
            if (emp) {
                document.getElementById('employeId').value = emp.id;
                document.getElementById('nom').value = emp.nom;
                document.getElementById('poste').value = emp.poste;
                document.getElementById('shift').value = emp.shift;
                openModal(true);
            }
        }

        function deleteEmploye(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer cet employé ?')) {
                DataManager.delete(STORAGE_KEYS.EMPLOYES, id);
                renderTable();
            }
        }

        // Form Submit
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const id = document.getElementById('employeId').value;
            const employeData = {
                id: id ? parseInt(id) : null,
                nom: document.getElementById('nom').value,
                poste: document.getElementById('poste').value,
                shift: document.getElementById('shift').value
            };

            if (id) {
                DataManager.update(STORAGE_KEYS.EMPLOYES, employeData);
            } else {
                DataManager.add(STORAGE_KEYS.EMPLOYES, employeData);
            }

            closeModal();
            renderTable();
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderTable();

            // Check for URL params
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('action') === 'new') {
                openModal();
            }
        });
        window.onclick = (event) => {
            if (event.target == modal) closeModal();
        };
    </script>
</body>

</html>